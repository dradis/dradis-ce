#!/bin/bash

set -e

result_info="bundle exec rubocop $(git diff-tree -r --no-commit-id --name-only origin/develop..HEAD)"
files_inspected=`$result_info | grep "files inspected\|file inspected" | cut -d " " -f1`
warning_count=`$result_info | grep "offenses detected\|offense detected" | cut -d " " -f4`

if [ $warning_count != 'no' ]
then
  echo -e "âŒ Inspected $files_inspected file(s) and detected $warning_count offense(s)"
  echo -e "ğŸ›  Try running 'bundle exec rubocop \$(git diff-tree -r --no-commit-id --name-only HEAD origin/develop) -A' to autocorrect any auto-correctable offenses"
  exit 1
else
  echo "âœ… Clean code! No rubocop offenses detected in $files_inspected changed files. Great job à² _à² "
  exit 0
fi
