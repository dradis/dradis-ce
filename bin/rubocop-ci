#!/bin/bash

set -e

result_info="bundle exec rubocop $(git diff-tree -r --no-commit-id --name-only origin/develop..HEAD | grep '\.rb$')"
files_inspected=`$result_info | grep "files inspected\|file inspected" | cut -d " " -f1`
warning_count=`$result_info | grep "offenses detected\|offense detected" | cut -d " " -f4`

if [ $warning_count != 'no' ]
then
  echo -e "‚ùå Inspected $files_inspected file(s) and detected $warning_count offense(s)"
  echo -e "üõ† Try running 'bundle exec rubocop \$(git diff-tree -r --no-commit-id --name-only HEAD origin/develop | grep '\.rb$') -A' to autocorrect any auto-correctable offenses"
  exit 1
else
  echo "‚úÖ Clean code! No rubocop offenses detected in $files_inspected changed files. Great job ‡≤†_‡≤†"
  exit 0
fi
